<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Wavee.WinUI.Views.LoginPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!--  Left Panel - OAuth Authorization Code Flow  -->
        <Grid Grid.Column="0" Padding="80,0">
            <StackPanel
                MaxWidth="400"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Spacing="0">

                <!--  Wavee Logo/Branding  -->
                <TextBlock
                    Margin="0,0,0,48"
                    FontSize="48"
                    FontWeight="Bold"
                    Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                    Text="Wavee" />

                <!--  Headline  -->
                <StackPanel Margin="0,0,0,48" Spacing="0">
                    <TextBlock
                        FontSize="32"
                        FontWeight="Bold"
                        Text="Millions of songs." />
                    <TextBlock
                        FontSize="32"
                        FontWeight="Bold"
                        Text="From Spotify." />
                </StackPanel>

                <!--  Login Button  -->
                <Button
                    Height="56"
                    Margin="0,0,0,24"
                    HorizontalAlignment="Stretch"
                    Command="{x:Bind ViewModel.LoginCommand}"
                    CornerRadius="28"
                    IsEnabled="{x:Bind ViewModel.IsLoggingIn, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}"
                    Style="{StaticResource AccentButtonStyle}">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <TextBlock
                            FontSize="16"
                            FontWeight="SemiBold"
                            Text="{x:Bind ViewModel.LoginButtonText, Mode=OneWay}" />
                        <FontIcon FontSize="16" Glyph="&#xE8A7;" />
                        <!--  External link icon  -->
                    </StackPanel>
                </Button>

                <!--  Loading Progress  -->
                <ProgressBar
                    Margin="0,0,0,24"
                    IsIndeterminate="True"
                    Visibility="{x:Bind ViewModel.IsLoggingIn, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />

                <!--  Sign Up Link  -->
                <HyperlinkButton
                    Margin="0,0,0,64"
                    HorizontalAlignment="Center"
                    NavigateUri="https://www.spotify.com/signup">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}" Text="New to Spotify?" />
                        <TextBlock
                            Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                            Text="Sign up for free"
                            TextDecorations="Underline" />
                        <FontIcon
                            FontSize="14"
                            Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                            Glyph="&#xE8A7;" />
                    </StackPanel>
                </HyperlinkButton>

                <!--  Error Message  -->
                <Border Margin="0,0,0,24" Visibility="{x:Bind ViewModel.ErrorMessage, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                    <InfoBar
                        IsClosable="True"
                        IsOpen="True"
                        Message="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                        Severity="Error" />
                </Border>

                <!--  Spacer to push Settings to bottom  -->
                <Grid Height="1" />

                <!--  Settings Link  -->
                <HyperlinkButton
                    Margin="0,24,0,0"
                    HorizontalAlignment="Left"
                    FontSize="14"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                    <TextBlock Text="Settings" />
                </HyperlinkButton>

            </StackPanel>
        </Grid>

        <!--  Right Panel - Device Code Flow with QR Code  -->
        <Grid Grid.Column="1" Padding="80,0">
            <!--  Vertical divider line  -->
            <Border
                HorizontalAlignment="Left"
                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                BorderThickness="1,0,0,0" />

            <StackPanel
                MaxWidth="400"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Spacing="24">

                <!--  QR Code  -->
                <Border
                    Width="250"
                    Height="250"
                    Padding="16"
                    Background="White"
                    CornerRadius="8"
                    Visibility="{x:Bind ViewModel.IsDeviceCodeActive, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Border.Shadow>
                        <ThemeShadow />
                    </Border.Shadow>
                    <Image Source="{x:Bind ViewModel.QrCodeImageUrl, Mode=OneWay, Converter={StaticResource StringToImageSourceConverter}}" Stretch="Uniform" />
                </Border>

                <!--  Loading QR Code  -->
                <StackPanel
                    HorizontalAlignment="Center"
                    Spacing="16"
                    Visibility="{x:Bind ViewModel.IsDeviceCodeActive, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                    <ProgressRing
                        Width="48"
                        Height="48"
                        HorizontalAlignment="Center"
                        IsActive="True" />
                    <TextBlock
                        HorizontalAlignment="Center"
                        FontSize="14"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Text="Generating QR code..." />
                </StackPanel>

                <!--  Heading  -->
                <TextBlock
                    HorizontalAlignment="Center"
                    FontSize="24"
                    FontWeight="SemiBold"
                    Text="Scan code to log in"
                    Visibility="{x:Bind ViewModel.IsDeviceCodeActive, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />

                <!--  Instructions  -->
                <TextBlock
                    HorizontalAlignment="Center"
                    FontSize="14"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    TextAlignment="Center"
                    TextWrapping="Wrap"
                    Visibility="{x:Bind ViewModel.IsDeviceCodeActive, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Run Text="On your mobile phone, open the camera" />
                    <LineBreak />
                    <Run Text="or the QR scanner app to scan this code." />
                </TextBlock>

                <!--  Device Code Display  -->
                <Border
                    Padding="16,12"
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    CornerRadius="8"
                    Visibility="{x:Bind ViewModel.IsDeviceCodeActive, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Spacing="8">
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            TextAlignment="Center">
                            <Run Text="Or enter this code manually at " />
                            <Hyperlink NavigateUri="https://www.spotify.com/pair">
                                <Run Text="spotify.com/pair" />
                            </Hyperlink>
                        </TextBlock>
                        <TextBlock
                            HorizontalAlignment="Center"
                            CharacterSpacing="8"
                            FontFamily="Consolas"
                            FontSize="24"
                            FontWeight="SemiBold"
                            IsTextSelectionEnabled="True"
                            Text="{x:Bind ViewModel.DeviceCode, Mode=OneWay}" />
                    </StackPanel>
                </Border>

                <!--  Status Message  -->
                <TextBlock
                    HorizontalAlignment="Center"
                    FontSize="14"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Text="{x:Bind ViewModel.DeviceCodeStatusMessage, Mode=OneWay}"
                    TextAlignment="Center"
                    Visibility="{x:Bind ViewModel.IsDeviceCodeActive, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />

            </StackPanel>
        </Grid>

    </Grid>

</Page>
