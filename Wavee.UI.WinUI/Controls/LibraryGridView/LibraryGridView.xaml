<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="Wavee.UI.WinUI.Controls.LibraryGridView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:Wavee.UI.WinUI.Controls"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Search Box -->
        <TextBox
            x:Name="SearchBox"
            Grid.Row="0"
            Margin="0,0,0,16"
            PlaceholderText="{x:Bind SearchPlaceholderText, Mode=OneWay}"
            Text="{x:Bind SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

        <!-- Two-column layout -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="ItemsColumn" Width="*" MinWidth="300"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition x:Name="DetailsColumn" Width="*" MinWidth="280"/>
            </Grid.ColumnDefinitions>

            <!-- Left: Items Grid -->
            <ItemsView
                x:Name="ItemsGridView"
                Grid.Column="0"
                ItemsSource="{x:Bind ItemsSource, Mode=OneWay}"
                ItemTemplate="{x:Bind ItemTemplate, Mode=OneWay}"
                SelectionMode="Single"
                SelectionChanged="ItemsGridView_SelectionChanged"
                Margin="0,0,8,0">
                <ItemsView.Layout>
                    <UniformGridLayout
                        MinItemWidth="{x:Bind MinItemWidth, Mode=OneWay}"
                        MinItemHeight="{x:Bind MinItemHeight, Mode=OneWay}"
                        MinRowSpacing="12"
                        MinColumnSpacing="12"
                        ItemsStretch="Uniform"/>
                </ItemsView.Layout>
            </ItemsView>

            <!-- GridSplitter -->
            <controls:GridSplitter
                Grid.Column="1"
                Width="8"
                Margin="4,0"/>

            <!-- Right: Detail Panel -->
            <Grid
                Grid.Column="2"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="8"
                Padding="16">

                <!-- Empty state when nothing selected -->
                <StackPanel
                    x:Name="EmptyStatePanel"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Spacing="12"
                    Visibility="{x:Bind SelectedItem, Converter={StaticResource InverseNullToVisibilityConverter}, Mode=OneWay}">
                    <FontIcon
                        Glyph="{x:Bind EmptyStateGlyph, Mode=OneWay}"
                        FontSize="48"
                        Opacity="0.3"/>
                    <TextBlock
                        Text="{x:Bind EmptyStateText, Mode=OneWay}"
                        Style="{StaticResource BodyTextBlockStyle}"
                        Opacity="0.5"
                        TextAlignment="Center"/>
                </StackPanel>

                <!-- Detail content -->
                <ContentPresenter
                    x:Name="DetailContentPresenter"
                    Content="{x:Bind DetailContent, Mode=OneWay}"
                    Visibility="{x:Bind SelectedItem, Converter={StaticResource NullToVisibilityConverter}, Mode=OneWay}"/>
            </Grid>
        </Grid>

        <!-- Loading overlay -->
        <ProgressRing
            Grid.RowSpan="2"
            IsActive="{x:Bind IsLoading, Mode=OneWay}"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"/>
    </Grid>
</UserControl>
